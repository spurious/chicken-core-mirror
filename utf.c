/* utf.c - UTF-8 support code
;
; Copyright (c) 2022-2022, The CHICKEN Team
; All rights reserved.
;
; Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following
; conditions are met:
;
;   Redistributions of source code must retain the above copyright notice, this list of conditions and the following
;     disclaimer. 
;   Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following
;     disclaimer in the documentation and/or other materials provided with the distribution. 
;   Neither the name of the author nor the names of its contributors may be used to endorse or promote
;     products derived from this software without specific prior written permission. 
;
; THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS
; OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY
; AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDERS OR
; CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
; CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
; SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
; THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR
; OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
; POSSIBILITY OF SUCH DAMAGE.
*/


#include "chicken.h"

/* case mapping code mostly stolen from Alex Shinn's utf8 egg */

#define CASE_MAP1_LENGTH 6052

static int case_map1[ CASE_MAP1_LENGTH * 4 ] = {
65, 65, 97, 65, 66, 66, 98, 66, 67, 67, 99, 67, 68, 68, 100,
68, 69, 69, 101, 69, 70, 70, 102, 70, 71, 71, 103, 71, 72, 72,
104, 72, 73, 73, 105, 73, 74, 74, 106, 74, 75,
75, 107, 75, 76, 76, 108, 76, 77, 77, 109, 77, 78, 78, 110, 78, 79,
79, 111, 79, 80, 80, 112, 80, 81, 81, 113, 81, 82, 82, 114, 82, 83,
83, 115, 83, 84, 84, 116, 84, 85, 85, 117, 85, 86, 86, 118, 86, 87,
87, 119, 87, 88, 88, 120, 88, 89, 89, 121, 89, 90, 90, 122, 90, 97,
65, 97, 65, 98, 66, 98, 66, 99, 67, 99, 67, 100, 68, 100, 68, 101,
69, 101, 69, 102, 70, 102, 70, 103, 71, 103, 71, 104, 72, 104, 72,
105, 73, 105, 73, 106, 74, 106, 74, 107, 75, 107, 75, 108, 76, 108,
76, 109, 77, 109, 77, 110, 78, 110, 78, 111, 79, 111, 79, 112, 80,
112, 80, 113, 81, 113, 81, 114, 82, 114, 82, 115, 83, 115, 83, 116,
84, 116, 84, 117, 85, 117, 85, 118, 86, 118, 86, 119, 87, 119, 87,
120, 88, 120, 88, 121, 89, 121, 89, 122, 90, 122, 90, 181, 924,
181, 924, 192, 192, 224, 192, 193, 193, 225, 193, 194, 194, 226,
194, 195, 195, 227, 195, 196, 196, 228, 196, 197, 197, 229, 197,
198, 198, 230, 198, 199, 199, 231, 199, 200, 200, 232, 200, 201,
201, 233, 201, 202, 202, 234, 202, 203, 203, 235, 203, 204, 204,
236, 204, 205, 205, 237, 205, 206, 206, 238, 206, 207, 207, 239,
207, 208, 208, 240, 208, 209, 209, 241, 209, 210, 210, 242, 210,
211, 211, 243, 211, 212, 212, 244, 212, 213, 213, 245, 213, 214,
214, 246, 214, 216, 216, 248, 216, 217, 217, 249, 217, 218, 218,
250, 218, 219, 219, 251, 219, 220, 220, 252, 220, 221, 221, 253,
221, 222, 222, 254, 222, 224, 192, 224, 192, 225, 193, 225, 193,
226, 194, 226, 194, 227, 195, 227, 195, 228, 196, 228, 196, 229,
197, 229, 197, 230, 198, 230, 198, 231, 199, 231, 199, 232, 200,
232, 200, 233, 201, 233, 201, 234, 202, 234, 202, 235, 203, 235,
203, 236, 204, 236, 204, 237, 205, 237, 205, 238, 206, 238, 206,
239, 207, 239, 207, 240, 208, 240, 208, 241, 209, 241, 209, 242,
210, 242, 210, 243, 211, 243, 211, 244, 212, 244, 212, 245, 213,
245, 213, 246, 214, 246, 214, 248, 216, 248, 216, 249, 217, 249,
217, 250, 218, 250, 218, 251, 219, 251, 219, 252, 220, 252, 220,
253, 221, 253, 221, 254, 222, 254, 222, 255, 376, 255, 376, 256,
256, 257, 256, 257, 256, 257, 256, 258, 258, 259, 258, 259, 258,
259, 258, 260, 260, 261, 260, 261, 260, 261, 260, 262, 262, 263,
262, 263, 262, 263, 262, 264, 264, 265, 264, 265, 264, 265, 264,
266, 266, 267, 266, 267, 266, 267, 266, 268, 268, 269, 268, 269,
268, 269, 268, 270, 270, 271, 270, 271, 270, 271, 270, 272, 272,
273, 272, 273, 272, 273, 272, 274, 274, 275, 274, 275, 274, 275,
274, 276, 276, 277, 276, 277, 276, 277, 276, 278, 278, 279, 278,
279, 278, 279, 278, 280, 280, 281, 280, 281, 280, 281, 280, 282,
282, 283, 282, 283, 282, 283, 282, 284, 284, 285, 284, 285, 284,
285, 284, 286, 286, 287, 286, 287, 286, 287, 286, 288, 288, 289,
288, 289, 288, 289, 288, 290, 290, 291, 290, 291, 290, 291, 290,
292, 292, 293, 292, 293, 292, 293, 292, 294, 294, 295, 294, 295,
294, 295, 294, 296, 296, 297, 296, 297, 296, 297, 296, 298, 298,
299, 298, 299, 298, 299, 298, 300, 300, 301, 300, 301, 300, 301,
300, 302, 302, 303, 302, 303, 302, 303, 302, 304, 304, 105, 304,
305, 73, 305, 73, 306, 306, 307, 306, 307, 306, 307, 306, 308, 308,
309, 308, 309, 308, 309, 308, 310, 310, 311, 310, 311, 310, 311,
310, 313, 313, 314, 313, 314, 313, 314, 313, 315, 315, 316, 315,
316, 315, 316, 315, 317, 317, 318, 317, 318, 317, 318, 317, 319,
319, 320, 319, 320, 319, 320, 319, 321, 321, 322, 321, 322, 321,
322, 321, 323, 323, 324, 323, 324, 323, 324, 323, 325, 325, 326,
325, 326, 325, 326, 325, 327, 327, 328, 327, 328, 327, 328, 327,
330, 330, 331, 330, 331, 330, 331, 330, 332, 332, 333, 332, 333,
332, 333, 332, 334, 334, 335, 334, 335, 334, 335, 334, 336, 336,
337, 336, 337, 336, 337, 336, 338, 338, 339, 338, 339, 338, 339,
338, 340, 340, 341, 340, 341, 340, 341, 340, 342, 342, 343, 342,
343, 342, 343, 342, 344, 344, 345, 344, 345, 344, 345, 344, 346,
346, 347, 346, 347, 346, 347, 346, 348, 348, 349, 348, 349, 348,
349, 348, 350, 350, 351, 350, 351, 350, 351, 350, 352, 352, 353,
352, 353, 352, 353, 352, 354, 354, 355, 354, 355, 354, 355, 354,
356, 356, 357, 356, 357, 356, 357, 356, 358, 358, 359, 358, 359,
358, 359, 358, 360, 360, 361, 360, 361, 360, 361, 360, 362, 362,
363, 362, 363, 362, 363, 362, 364, 364, 365, 364, 365, 364, 365,
364, 366, 366, 367, 366, 367, 366, 367, 366, 368, 368, 369, 368,
369, 368, 369, 368, 370, 370, 371, 370, 371, 370, 371, 370, 372,
372, 373, 372, 373, 372, 373, 372, 374, 374, 375, 374, 375, 374,
375, 374, 376, 376, 255, 376, 377, 377, 378, 377, 378, 377, 378,
377, 379, 379, 380, 379, 380, 379, 380, 379, 381, 381, 382, 381,
382, 381, 382, 381, 383, 83, 383, 83, 385, 385, 595, 385, 386, 386,
387, 386, 387, 386, 387, 386, 388, 388, 389, 388, 389, 388, 389,
388, 390, 390, 596, 390, 391, 391, 392, 391, 392, 391, 392, 391,
393, 393, 598, 393, 394, 394, 599, 394, 395, 395, 396, 395, 396,
395, 396, 395, 398, 398, 477, 398, 399, 399, 601, 399, 400, 400,
603, 400, 401, 401, 402, 401, 402, 401, 402, 401, 403, 403, 608,
403, 404, 404, 611, 404, 405, 502, 405, 502, 406, 406, 617, 406,
407, 407, 616, 407, 408, 408, 409, 408, 409, 408, 409, 408, 412,
412, 623, 412, 413, 413, 626, 413, 414, 544, 414, 544, 415, 415,
629, 415, 416, 416, 417, 416, 417, 416, 417, 416, 418, 418, 419,
418, 419, 418, 419, 418, 420, 420, 421, 420, 421, 420, 421, 420,
422, 422, 640, 422, 423, 423, 424, 423, 424, 423, 424, 423, 425,
425, 643, 425, 428, 428, 429, 428, 429, 428, 429, 428, 430, 430,
648, 430, 431, 431, 432, 431, 432, 431, 432, 431, 433, 433, 650,
433, 434, 434, 651, 434, 435, 435, 436, 435, 436, 435, 436, 435,
437, 437, 438, 437, 438, 437, 438, 437, 439, 439, 658, 439, 440,
440, 441, 440, 441, 440, 441, 440, 444, 444, 445, 444, 445, 444,
445, 444, 447, 503, 447, 503, 452, 452, 454, 453, 453, 452, 454,
453, 454, 452, 454, 453, 455, 455, 457, 456, 456, 455, 457, 456,
457, 455, 457, 456, 458, 458, 460, 459, 459, 458, 460, 459, 460,
458, 460, 459, 461, 461, 462, 461, 462, 461, 462, 461, 463, 463,
464, 463, 464, 463, 464, 463, 465, 465, 466, 465, 466, 465, 466,
465, 467, 467, 468, 467, 468, 467, 468, 467, 469, 469, 470, 469,
470, 469, 470, 469, 471, 471, 472, 471, 472, 471, 472, 471, 473,
473, 474, 473, 474, 473, 474, 473, 475, 475, 476, 475, 476, 475,
476, 475, 477, 398, 477, 398, 478, 478, 479, 478, 479, 478, 479,
478, 480, 480, 481, 480, 481, 480, 481, 480, 482, 482, 483, 482,
483, 482, 483, 482, 484, 484, 485, 484, 485, 484, 485, 484, 486,
486, 487, 486, 487, 486, 487, 486, 488, 488, 489, 488, 489, 488,
489, 488, 490, 490, 491, 490, 491, 490, 491, 490, 492, 492, 493,
492, 493, 492, 493, 492, 494, 494, 495, 494, 495, 494, 495, 494,
497, 497, 499, 498, 498, 497, 499, 498, 499, 497, 499, 498, 500,
500, 501, 500, 501, 500, 501, 500, 502, 502, 405, 502, 503, 503,
447, 503, 504, 504, 505, 504, 505, 504, 505, 504, 506, 506, 507,
506, 507, 506, 507, 506, 508, 508, 509, 508, 509, 508, 509, 508,
510, 510, 511, 510, 511, 510, 511, 510, 512, 512, 513, 512, 513,
512, 513, 512, 514, 514, 515, 514, 515, 514, 515, 514, 516, 516,
517, 516, 517, 516, 517, 516, 518, 518, 519, 518, 519, 518, 519,
518, 520, 520, 521, 520, 521, 520, 521, 520, 522, 522, 523, 522,
523, 522, 523, 522, 524, 524, 525, 524, 525, 524, 525, 524, 526,
526, 527, 526, 527, 526, 527, 526, 528, 528, 529, 528, 529, 528,
529, 528, 530, 530, 531, 530, 531, 530, 531, 530, 532, 532, 533,
532, 533, 532, 533, 532, 534, 534, 535, 534, 535, 534, 535, 534,
536, 536, 537, 536, 537, 536, 537, 536, 538, 538, 539, 538, 539,
538, 539, 538, 540, 540, 541, 540, 541, 540, 541, 540, 542, 542,
543, 542, 543, 542, 543, 542, 544, 544, 414, 544, 546, 546, 547,
546, 547, 546, 547, 546, 548, 548, 549, 548, 549, 548, 549, 548,
550, 550, 551, 550, 551, 550, 551, 550, 552, 552, 553, 552, 553,
552, 553, 552, 554, 554, 555, 554, 555, 554, 555, 554, 556, 556,
557, 556, 557, 556, 557, 556, 558, 558, 559, 558, 559, 558, 559,
558, 560, 560, 561, 560, 561, 560, 561, 560, 562, 562, 563, 562,
563, 562, 563, 562, 595, 385, 595, 385, 596, 390, 596, 390, 598,
393, 598, 393, 599, 394, 599, 394, 601, 399, 601, 399, 603, 400,
603, 400, 608, 403, 608, 403, 611, 404, 611, 404, 616, 407, 616,
407, 617, 406, 617, 406, 623, 412, 623, 412, 626, 413, 626, 413,
629, 415, 629, 415, 640, 422, 640, 422, 643, 425, 643, 425, 648,
430, 648, 430, 650, 433, 650, 433, 651, 434, 651, 434, 658, 439,
658, 439, 837, 921, 837, 921, 902, 902, 940, 902, 904, 904, 941,
904, 905, 905, 942, 905, 906, 906, 943, 906, 908, 908, 972, 908,
910, 910, 973, 910, 911, 911, 974, 911, 913, 913, 945, 913, 914,
914, 946, 914, 915, 915, 947, 915, 916, 916, 948, 916, 917, 917,
949, 917, 918, 918, 950, 918, 919, 919, 951, 919, 920, 920, 952,
920, 921, 921, 953, 921, 922, 922, 954, 922, 923, 923, 955, 923,
924, 924, 956, 924, 925, 925, 957, 925, 926, 926, 958, 926, 927,
927, 959, 927, 928, 928, 960, 928, 929, 929, 961, 929, 931, 931,
963, 931, 932, 932, 964, 932, 933, 933, 965, 933, 934, 934, 966,
934, 935, 935, 967, 935, 936, 936, 968, 936, 937, 937, 969, 937,
938, 938, 970, 938, 939, 939, 971, 939, 940, 902, 940, 902, 941,
904, 941, 904, 942, 905, 942, 905, 943, 906, 943, 906, 945, 913,
945, 913, 946, 914, 946, 914, 947, 915, 947, 915, 948, 916, 948,
916, 949, 917, 949, 917, 950, 918, 950, 918, 951, 919, 951, 919,
952, 920, 952, 920, 953, 921, 953, 921, 954, 922, 954, 922, 955,
923, 955, 923, 956, 924, 956, 924, 957, 925, 957, 925, 958, 926,
958, 926, 959, 927, 959, 927, 960, 928, 960, 928, 961, 929, 961,
929, 962, 931, 962, 931, 963, 931, 963, 931, 964, 932, 964, 932,
965, 933, 965, 933, 966, 934, 966, 934, 967, 935, 967, 935, 968,
936, 968, 936, 969, 937, 969, 937, 970, 938, 970, 938, 971, 939,
971, 939, 972, 908, 972, 908, 973, 910, 973, 910, 974, 911, 974,
911, 976, 914, 976, 914, 977, 920, 977, 920, 981, 934, 981, 934,
982, 928, 982, 928, 984, 984, 985, 984, 985, 984, 985, 984, 986,
986, 987, 986, 987, 986, 987, 986, 988, 988, 989, 988, 989, 988,
989, 988, 990, 990, 991, 990, 991, 990, 991, 990, 992, 992, 993,
992, 993, 992, 993, 992, 994, 994, 995, 994, 995, 994, 995, 994,
996, 996, 997, 996, 997, 996, 997, 996, 998, 998, 999, 998, 999,
998, 999, 998, 1000, 1000, 1001, 1000, 1001, 1000, 1001, 1000, 1002,
1002, 1003, 1002, 1003, 1002, 1003, 1002, 1004, 1004, 1005, 1004,
1005, 1004, 1005, 1004, 1006, 1006, 1007, 1006, 1007, 1006, 1007,
1006, 1008, 922, 1008, 922, 1009, 929, 1009, 929, 1010, 1017, 1010,
1017, 1012, 1012, 952, 1012, 1013, 917, 1013, 917, 1015, 1015, 1016,
1015, 1016, 1015, 1016, 1015, 1017, 1017, 1010, 1017, 1018, 1018,
1019, 1018, 1019, 1018, 1019, 1018, 1024, 1024, 1104, 1024, 1025,
1025, 1105, 1025, 1026, 1026, 1106, 1026, 1027, 1027, 1107, 1027,
1028, 1028, 1108, 1028, 1029, 1029, 1109, 1029, 1030, 1030, 1110,
1030, 1031, 1031, 1111, 1031, 1032, 1032, 1112, 1032, 1033, 1033,
1113, 1033, 1034, 1034, 1114, 1034, 1035, 1035, 1115, 1035, 1036,
1036, 1116, 1036, 1037, 1037, 1117, 1037, 1038, 1038, 1118, 1038,
1039, 1039, 1119, 1039, 1040, 1040, 1072, 1040, 1041, 1041, 1073,
1041, 1042, 1042, 1074, 1042, 1043, 1043, 1075, 1043, 1044, 1044,
1076, 1044, 1045, 1045, 1077, 1045, 1046, 1046, 1078, 1046, 1047,
1047, 1079, 1047, 1048, 1048, 1080, 1048, 1049, 1049, 1081, 1049,
1050, 1050, 1082, 1050, 1051, 1051, 1083, 1051, 1052, 1052, 1084,
1052, 1053, 1053, 1085, 1053, 1054, 1054, 1086, 1054, 1055, 1055,
1087, 1055, 1056, 1056, 1088, 1056, 1057, 1057, 1089, 1057, 1058,
1058, 1090, 1058, 1059, 1059, 1091, 1059, 1060, 1060, 1092, 1060,
1061, 1061, 1093, 1061, 1062, 1062, 1094, 1062, 1063, 1063, 1095,
1063, 1064, 1064, 1096, 1064, 1065, 1065, 1097, 1065, 1066, 1066,
1098, 1066, 1067, 1067, 1099, 1067, 1068, 1068, 1100, 1068, 1069,
1069, 1101, 1069, 1070, 1070, 1102, 1070, 1071, 1071, 1103, 1071,
1072, 1040, 1072, 1040, 1073, 1041, 1073, 1041, 1074, 1042, 1074,
1042, 1075, 1043, 1075, 1043, 1076, 1044, 1076, 1044, 1077, 1045,
1077, 1045, 1078, 1046, 1078, 1046, 1079, 1047, 1079, 1047, 1080,
1048, 1080, 1048, 1081, 1049, 1081, 1049, 1082, 1050, 1082, 1050,
1083, 1051, 1083, 1051, 1084, 1052, 1084, 1052, 1085, 1053, 1085,
1053, 1086, 1054, 1086, 1054, 1087, 1055, 1087, 1055, 1088, 1056,
1088, 1056, 1089, 1057, 1089, 1057, 1090, 1058, 1090, 1058, 1091,
1059, 1091, 1059, 1092, 1060, 1092, 1060, 1093, 1061, 1093, 1061,
1094, 1062, 1094, 1062, 1095, 1063, 1095, 1063, 1096, 1064, 1096,
1064, 1097, 1065, 1097, 1065, 1098, 1066, 1098, 1066, 1099, 1067,
1099, 1067, 1100, 1068, 1100, 1068, 1101, 1069, 1101, 1069, 1102,
1070, 1102, 1070, 1103, 1071, 1103, 1071, 1104, 1024, 1104, 1024,
1105, 1025, 1105, 1025, 1106, 1026, 1106, 1026, 1107, 1027, 1107,
1027, 1108, 1028, 1108, 1028, 1109, 1029, 1109, 1029, 1110, 1030,
1110, 1030, 1111, 1031, 1111, 1031, 1112, 1032, 1112, 1032, 1113,
1033, 1113, 1033, 1114, 1034, 1114, 1034, 1115, 1035, 1115, 1035,
1116, 1036, 1116, 1036, 1117, 1037, 1117, 1037, 1118, 1038, 1118,
1038, 1119, 1039, 1119, 1039, 1120, 1120, 1121, 1120, 1121, 1120,
1121, 1120, 1122, 1122, 1123, 1122, 1123, 1122, 1123, 1122, 1124,
1124, 1125, 1124, 1125, 1124, 1125, 1124, 1126, 1126, 1127, 1126,
1127, 1126, 1127, 1126, 1128, 1128, 1129, 1128, 1129, 1128, 1129,
1128, 1130, 1130, 1131, 1130, 1131, 1130, 1131, 1130, 1132, 1132,
1133, 1132, 1133, 1132, 1133, 1132, 1134, 1134, 1135, 1134, 1135,
1134, 1135, 1134, 1136, 1136, 1137, 1136, 1137, 1136, 1137, 1136,
1138, 1138, 1139, 1138, 1139, 1138, 1139, 1138, 1140, 1140, 1141,
1140, 1141, 1140, 1141, 1140, 1142, 1142, 1143, 1142, 1143, 1142,
1143, 1142, 1144, 1144, 1145, 1144, 1145, 1144, 1145, 1144, 1146,
1146, 1147, 1146, 1147, 1146, 1147, 1146, 1148, 1148, 1149, 1148,
1149, 1148, 1149, 1148, 1150, 1150, 1151, 1150, 1151, 1150, 1151,
1150, 1152, 1152, 1153, 1152, 1153, 1152, 1153, 1152, 1162, 1162,
1163, 1162, 1163, 1162, 1163, 1162, 1164, 1164, 1165, 1164, 1165,
1164, 1165, 1164, 1166, 1166, 1167, 1166, 1167, 1166, 1167, 1166,
1168, 1168, 1169, 1168, 1169, 1168, 1169, 1168, 1170, 1170, 1171,
1170, 1171, 1170, 1171, 1170, 1172, 1172, 1173, 1172, 1173, 1172,
1173, 1172, 1174, 1174, 1175, 1174, 1175, 1174, 1175, 1174, 1176,
1176, 1177, 1176, 1177, 1176, 1177, 1176, 1178, 1178, 1179, 1178,
1179, 1178, 1179, 1178, 1180, 1180, 1181, 1180, 1181, 1180, 1181,
1180, 1182, 1182, 1183, 1182, 1183, 1182, 1183, 1182, 1184, 1184,
1185, 1184, 1185, 1184, 1185, 1184, 1186, 1186, 1187, 1186, 1187,
1186, 1187, 1186, 1188, 1188, 1189, 1188, 1189, 1188, 1189, 1188,
1190, 1190, 1191, 1190, 1191, 1190, 1191, 1190, 1192, 1192, 1193,
1192, 1193, 1192, 1193, 1192, 1194, 1194, 1195, 1194, 1195, 1194,
1195, 1194, 1196, 1196, 1197, 1196, 1197, 1196, 1197, 1196, 1198,
1198, 1199, 1198, 1199, 1198, 1199, 1198, 1200, 1200, 1201, 1200,
1201, 1200, 1201, 1200, 1202, 1202, 1203, 1202, 1203, 1202, 1203,
1202, 1204, 1204, 1205, 1204, 1205, 1204, 1205, 1204, 1206, 1206,
1207, 1206, 1207, 1206, 1207, 1206, 1208, 1208, 1209, 1208, 1209,
1208, 1209, 1208, 1210, 1210, 1211, 1210, 1211, 1210, 1211, 1210,
1212, 1212, 1213, 1212, 1213, 1212, 1213, 1212, 1214, 1214, 1215,
1214, 1215, 1214, 1215, 1214, 1217, 1217, 1218, 1217, 1218, 1217,
1218, 1217, 1219, 1219, 1220, 1219, 1220, 1219, 1220, 1219, 1221,
1221, 1222, 1221, 1222, 1221, 1222, 1221, 1223, 1223, 1224, 1223,
1224, 1223, 1224, 1223, 1225, 1225, 1226, 1225, 1226, 1225, 1226,
1225, 1227, 1227, 1228, 1227, 1228, 1227, 1228, 1227, 1229, 1229,
1230, 1229, 1230, 1229, 1230, 1229, 1232, 1232, 1233, 1232, 1233,
1232, 1233, 1232, 1234, 1234, 1235, 1234, 1235, 1234, 1235, 1234,
1236, 1236, 1237, 1236, 1237, 1236, 1237, 1236, 1238, 1238, 1239,
1238, 1239, 1238, 1239, 1238, 1240, 1240, 1241, 1240, 1241, 1240,
1241, 1240, 1242, 1242, 1243, 1242, 1243, 1242, 1243, 1242, 1244,
1244, 1245, 1244, 1245, 1244, 1245, 1244, 1246, 1246, 1247, 1246,
1247, 1246, 1247, 1246, 1248, 1248, 1249, 1248, 1249, 1248, 1249,
1248, 1250, 1250, 1251, 1250, 1251, 1250, 1251, 1250, 1252, 1252,
1253, 1252, 1253, 1252, 1253, 1252, 1254, 1254, 1255, 1254, 1255,
1254, 1255, 1254, 1256, 1256, 1257, 1256, 1257, 1256, 1257, 1256,
1258, 1258, 1259, 1258, 1259, 1258, 1259, 1258, 1260, 1260, 1261,
1260, 1261, 1260, 1261, 1260, 1262, 1262, 1263, 1262, 1263, 1262,
1263, 1262, 1264, 1264, 1265, 1264, 1265, 1264, 1265, 1264, 1266,
1266, 1267, 1266, 1267, 1266, 1267, 1266, 1268, 1268, 1269, 1268,
1269, 1268, 1269, 1268, 1272, 1272, 1273, 1272, 1273, 1272, 1273,
1272, 1280, 1280, 1281, 1280, 1281, 1280, 1281, 1280, 1282, 1282,
1283, 1282, 1283, 1282, 1283, 1282, 1284, 1284, 1285, 1284, 1285,
1284, 1285, 1284, 1286, 1286, 1287, 1286, 1287, 1286, 1287, 1286,
1288, 1288, 1289, 1288, 1289, 1288, 1289, 1288, 1290, 1290, 1291,
1290, 1291, 1290, 1291, 1290, 1292, 1292, 1293, 1292, 1293, 1292,
1293, 1292, 1294, 1294, 1295, 1294, 1295, 1294, 1295, 1294, 1329,
1329, 1377, 1329, 1330, 1330, 1378, 1330, 1331, 1331, 1379, 1331,
1332, 1332, 1380, 1332, 1333, 1333, 1381, 1333, 1334, 1334, 1382,
1334, 1335, 1335, 1383, 1335, 1336, 1336, 1384, 1336, 1337, 1337,
1385, 1337, 1338, 1338, 1386, 1338, 1339, 1339, 1387, 1339, 1340,
1340, 1388, 1340, 1341, 1341, 1389, 1341, 1342, 1342, 1390, 1342,
1343, 1343, 1391, 1343, 1344, 1344, 1392, 1344, 1345, 1345, 1393,
1345, 1346, 1346, 1394, 1346, 1347, 1347, 1395, 1347, 1348, 1348,
1396, 1348, 1349, 1349, 1397, 1349, 1350, 1350, 1398, 1350, 1351,
1351, 1399, 1351, 1352, 1352, 1400, 1352, 1353, 1353, 1401, 1353,
1354, 1354, 1402, 1354, 1355, 1355, 1403, 1355, 1356, 1356, 1404,
1356, 1357, 1357, 1405, 1357, 1358, 1358, 1406, 1358, 1359, 1359,
1407, 1359, 1360, 1360, 1408, 1360, 1361, 1361, 1409, 1361, 1362,
1362, 1410, 1362, 1363, 1363, 1411, 1363, 1364, 1364, 1412, 1364,
1365, 1365, 1413, 1365, 1366, 1366, 1414, 1366, 1377, 1329, 1377,
1329, 1378, 1330, 1378, 1330, 1379, 1331, 1379, 1331, 1380, 1332,
1380, 1332, 1381, 1333, 1381, 1333, 1382, 1334, 1382, 1334, 1383,
1335, 1383, 1335, 1384, 1336, 1384, 1336, 1385, 1337, 1385, 1337,
1386, 1338, 1386, 1338, 1387, 1339, 1387, 1339, 1388, 1340, 1388,
1340, 1389, 1341, 1389, 1341, 1390, 1342, 1390, 1342, 1391, 1343,
1391, 1343, 1392, 1344, 1392, 1344, 1393, 1345, 1393, 1345, 1394,
1346, 1394, 1346, 1395, 1347, 1395, 1347, 1396, 1348, 1396, 1348,
1397, 1349, 1397, 1349, 1398, 1350, 1398, 1350, 1399, 1351, 1399,
1351, 1400, 1352, 1400, 1352, 1401, 1353, 1401, 1353, 1402, 1354,
1402, 1354, 1403, 1355, 1403, 1355, 1404, 1356, 1404, 1356, 1405,
1357, 1405, 1357, 1406, 1358, 1406, 1358, 1407, 1359, 1407, 1359,
1408, 1360, 1408, 1360, 1409, 1361, 1409, 1361, 1410, 1362, 1410,
1362, 1411, 1363, 1411, 1363, 1412, 1364, 1412, 1364, 1413, 1365,
1413, 1365, 1414, 1366, 1414, 1366, 7680, 7680, 7681, 7680, 7681,
7680, 7681, 7680, 7682, 7682, 7683, 7682, 7683, 7682, 7683, 7682,
7684, 7684, 7685, 7684, 7685, 7684, 7685, 7684, 7686, 7686, 7687,
7686, 7687, 7686, 7687, 7686, 7688, 7688, 7689, 7688, 7689, 7688,
7689, 7688, 7690, 7690, 7691, 7690, 7691, 7690, 7691, 7690, 7692,
7692, 7693, 7692, 7693, 7692, 7693, 7692, 7694, 7694, 7695, 7694,
7695, 7694, 7695, 7694, 7696, 7696, 7697, 7696, 7697, 7696, 7697,
7696, 7698, 7698, 7699, 7698, 7699, 7698, 7699, 7698, 7700, 7700,
7701, 7700, 7701, 7700, 7701, 7700, 7702, 7702, 7703, 7702, 7703,
7702, 7703, 7702, 7704, 7704, 7705, 7704, 7705, 7704, 7705, 7704,
7706, 7706, 7707, 7706, 7707, 7706, 7707, 7706, 7708, 7708, 7709,
7708, 7709, 7708, 7709, 7708, 7710, 7710, 7711, 7710, 7711, 7710,
7711, 7710, 7712, 7712, 7713, 7712, 7713, 7712, 7713, 7712, 7714,
7714, 7715, 7714, 7715, 7714, 7715, 7714, 7716, 7716, 7717, 7716,
7717, 7716, 7717, 7716, 7718, 7718, 7719, 7718, 7719, 7718, 7719,
7718, 7720, 7720, 7721, 7720, 7721, 7720, 7721, 7720, 7722, 7722,
7723, 7722, 7723, 7722, 7723, 7722, 7724, 7724, 7725, 7724, 7725,
7724, 7725, 7724, 7726, 7726, 7727, 7726, 7727, 7726, 7727, 7726,
7728, 7728, 7729, 7728, 7729, 7728, 7729, 7728, 7730, 7730, 7731,
7730, 7731, 7730, 7731, 7730, 7732, 7732, 7733, 7732, 7733, 7732,
7733, 7732, 7734, 7734, 7735, 7734, 7735, 7734, 7735, 7734, 7736,
7736, 7737, 7736, 7737, 7736, 7737, 7736, 7738, 7738, 7739, 7738,
7739, 7738, 7739, 7738, 7740, 7740, 7741, 7740, 7741, 7740, 7741,
7740, 7742, 7742, 7743, 7742, 7743, 7742, 7743, 7742, 7744, 7744,
7745, 7744, 7745, 7744, 7745, 7744, 7746, 7746, 7747, 7746, 7747,
7746, 7747, 7746, 7748, 7748, 7749, 7748, 7749, 7748, 7749, 7748,
7750, 7750, 7751, 7750, 7751, 7750, 7751, 7750, 7752, 7752, 7753,
7752, 7753, 7752, 7753, 7752, 7754, 7754, 7755, 7754, 7755, 7754,
7755, 7754, 7756, 7756, 7757, 7756, 7757, 7756, 7757, 7756, 7758,
7758, 7759, 7758, 7759, 7758, 7759, 7758, 7760, 7760, 7761, 7760,
7761, 7760, 7761, 7760, 7762, 7762, 7763, 7762, 7763, 7762, 7763,
7762, 7764, 7764, 7765, 7764, 7765, 7764, 7765, 7764, 7766, 7766,
7767, 7766, 7767, 7766, 7767, 7766, 7768, 7768, 7769, 7768, 7769,
7768, 7769, 7768, 7770, 7770, 7771, 7770, 7771, 7770, 7771, 7770,
7772, 7772, 7773, 7772, 7773, 7772, 7773, 7772, 7774, 7774, 7775,
7774, 7775, 7774, 7775, 7774, 7776, 7776, 7777, 7776, 7777, 7776,
7777, 7776, 7778, 7778, 7779, 7778, 7779, 7778, 7779, 7778, 7780,
7780, 7781, 7780, 7781, 7780, 7781, 7780, 7782, 7782, 7783, 7782,
7783, 7782, 7783, 7782, 7784, 7784, 7785, 7784, 7785, 7784, 7785,
7784, 7786, 7786, 7787, 7786, 7787, 7786, 7787, 7786, 7788, 7788,
7789, 7788, 7789, 7788, 7789, 7788, 7790, 7790, 7791, 7790, 7791,
7790, 7791, 7790, 7792, 7792, 7793, 7792, 7793, 7792, 7793, 7792,
7794, 7794, 7795, 7794, 7795, 7794, 7795, 7794, 7796, 7796, 7797,
7796, 7797, 7796, 7797, 7796, 7798, 7798, 7799, 7798, 7799, 7798,
7799, 7798, 7800, 7800, 7801, 7800, 7801, 7800, 7801, 7800, 7802,
7802, 7803, 7802, 7803, 7802, 7803, 7802, 7804, 7804, 7805, 7804,
7805, 7804, 7805, 7804, 7806, 7806, 7807, 7806, 7807, 7806, 7807,
7806, 7808, 7808, 7809, 7808, 7809, 7808, 7809, 7808, 7810, 7810,
7811, 7810, 7811, 7810, 7811, 7810, 7812, 7812, 7813, 7812, 7813,
7812, 7813, 7812, 7814, 7814, 7815, 7814, 7815, 7814, 7815, 7814,
7816, 7816, 7817, 7816, 7817, 7816, 7817, 7816, 7818, 7818, 7819,
7818, 7819, 7818, 7819, 7818, 7820, 7820, 7821, 7820, 7821, 7820,
7821, 7820, 7822, 7822, 7823, 7822, 7823, 7822, 7823, 7822, 7824,
7824, 7825, 7824, 7825, 7824, 7825, 7824, 7826, 7826, 7827, 7826,
7827, 7826, 7827, 7826, 7828, 7828, 7829, 7828, 7829, 7828, 7829,
7828, 7835, 7776, 7835, 7776, 7840, 7840, 7841, 7840, 7841, 7840,
7841, 7840, 7842, 7842, 7843, 7842, 7843, 7842, 7843, 7842, 7844,
7844, 7845, 7844, 7845, 7844, 7845, 7844, 7846, 7846, 7847, 7846,
7847, 7846, 7847, 7846, 7848, 7848, 7849, 7848, 7849, 7848, 7849,
7848, 7850, 7850, 7851, 7850, 7851, 7850, 7851, 7850, 7852, 7852,
7853, 7852, 7853, 7852, 7853, 7852, 7854, 7854, 7855, 7854, 7855,
7854, 7855, 7854, 7856, 7856, 7857, 7856, 7857, 7856, 7857, 7856,
7858, 7858, 7859, 7858, 7859, 7858, 7859, 7858, 7860, 7860, 7861,
7860, 7861, 7860, 7861, 7860, 7862, 7862, 7863, 7862, 7863, 7862,
7863, 7862, 7864, 7864, 7865, 7864, 7865, 7864, 7865, 7864, 7866,
7866, 7867, 7866, 7867, 7866, 7867, 7866, 7868, 7868, 7869, 7868,
7869, 7868, 7869, 7868, 7870, 7870, 7871, 7870, 7871, 7870, 7871,
7870, 7872, 7872, 7873, 7872, 7873, 7872, 7873, 7872, 7874, 7874,
7875, 7874, 7875, 7874, 7875, 7874, 7876, 7876, 7877, 7876, 7877,
7876, 7877, 7876, 7878, 7878, 7879, 7878, 7879, 7878, 7879, 7878,
7880, 7880, 7881, 7880, 7881, 7880, 7881, 7880, 7882, 7882, 7883,
7882, 7883, 7882, 7883, 7882, 7884, 7884, 7885, 7884, 7885, 7884,
7885, 7884, 7886, 7886, 7887, 7886, 7887, 7886, 7887, 7886, 7888,
7888, 7889, 7888, 7889, 7888, 7889, 7888, 7890, 7890, 7891, 7890,
7891, 7890, 7891, 7890, 7892, 7892, 7893, 7892, 7893, 7892, 7893,
7892, 7894, 7894, 7895, 7894, 7895, 7894, 7895, 7894, 7896, 7896,
7897, 7896, 7897, 7896, 7897, 7896, 7898, 7898, 7899, 7898, 7899,
7898, 7899, 7898, 7900, 7900, 7901, 7900, 7901, 7900, 7901, 7900,
7902, 7902, 7903, 7902, 7903, 7902, 7903, 7902, 7904, 7904, 7905,
7904, 7905, 7904, 7905, 7904, 7906, 7906, 7907, 7906, 7907, 7906,
7907, 7906, 7908, 7908, 7909, 7908, 7909, 7908, 7909, 7908, 7910,
7910, 7911, 7910, 7911, 7910, 7911, 7910, 7912, 7912, 7913, 7912,
7913, 7912, 7913, 7912, 7914, 7914, 7915, 7914, 7915, 7914, 7915,
7914, 7916, 7916, 7917, 7916, 7917, 7916, 7917, 7916, 7918, 7918,
7919, 7918, 7919, 7918, 7919, 7918, 7920, 7920, 7921, 7920, 7921,
7920, 7921, 7920, 7922, 7922, 7923, 7922, 7923, 7922, 7923, 7922,
7924, 7924, 7925, 7924, 7925, 7924, 7925, 7924, 7926, 7926, 7927,
7926, 7927, 7926, 7927, 7926, 7928, 7928, 7929, 7928, 7929, 7928,
7929, 7928, 7936, 7944, 7936, 7944, 7937, 7945, 7937, 7945, 7938,
7946, 7938, 7946, 7939, 7947, 7939, 7947, 7940, 7948, 7940, 7948,
7941, 7949, 7941, 7949, 7942, 7950, 7942, 7950, 7943, 7951, 7943,
7951, 7944, 7944, 7936, 7944, 7945, 7945, 7937, 7945, 7946, 7946,
7938, 7946, 7947, 7947, 7939, 7947, 7948, 7948, 7940, 7948, 7949,
7949, 7941, 7949, 7950, 7950, 7942, 7950, 7951, 7951, 7943, 7951,
7952, 7960, 7952, 7960, 7953, 7961, 7953, 7961, 7954, 7962, 7954,
7962, 7955, 7963, 7955, 7963, 7956, 7964, 7956, 7964, 7957, 7965,
7957, 7965, 7960, 7960, 7952, 7960, 7961, 7961, 7953, 7961, 7962,
7962, 7954, 7962, 7963, 7963, 7955, 7963, 7964, 7964, 7956, 7964,
7965, 7965, 7957, 7965, 7968, 7976, 7968, 7976, 7969, 7977, 7969,
7977, 7970, 7978, 7970, 7978, 7971, 7979, 7971, 7979, 7972, 7980,
7972, 7980, 7973, 7981, 7973, 7981, 7974, 7982, 7974, 7982, 7975,
7983, 7975, 7983, 7976, 7976, 7968, 7976, 7977, 7977, 7969, 7977,
7978, 7978, 7970, 7978, 7979, 7979, 7971, 7979, 7980, 7980, 7972,
7980, 7981, 7981, 7973, 7981, 7982, 7982, 7974, 7982, 7983, 7983,
7975, 7983, 7984, 7992, 7984, 7992, 7985, 7993, 7985, 7993, 7986,
7994, 7986, 7994, 7987, 7995, 7987, 7995, 7988, 7996, 7988, 7996,
7989, 7997, 7989, 7997, 7990, 7998, 7990, 7998, 7991, 7999, 7991,
7999, 7992, 7992, 7984, 7992, 7993, 7993, 7985, 7993, 7994, 7994,
7986, 7994, 7995, 7995, 7987, 7995, 7996, 7996, 7988, 7996, 7997,
7997, 7989, 7997, 7998, 7998, 7990, 7998, 7999, 7999, 7991, 7999,
8000, 8008, 8000, 8008, 8001, 8009, 8001, 8009, 8002, 8010, 8002,
8010, 8003, 8011, 8003, 8011, 8004, 8012, 8004, 8012, 8005, 8013,
8005, 8013, 8008, 8008, 8000, 8008, 8009, 8009, 8001, 8009, 8010,
8010, 8002, 8010, 8011, 8011, 8003, 8011, 8012, 8012, 8004, 8012,
8013, 8013, 8005, 8013, 8017, 8025, 8017, 8025, 8019, 8027, 8019,
8027, 8021, 8029, 8021, 8029, 8023, 8031, 8023, 8031, 8025, 8025,
8017, 8025, 8027, 8027, 8019, 8027, 8029, 8029, 8021, 8029, 8031,
8031, 8023, 8031, 8032, 8040, 8032, 8040, 8033, 8041, 8033, 8041,
8034, 8042, 8034, 8042, 8035, 8043, 8035, 8043, 8036, 8044, 8036,
8044, 8037, 8045, 8037, 8045, 8038, 8046, 8038, 8046, 8039, 8047,
8039, 8047, 8040, 8040, 8032, 8040, 8041, 8041, 8033, 8041, 8042,
8042, 8034, 8042, 8043, 8043, 8035, 8043, 8044, 8044, 8036, 8044,
8045, 8045, 8037, 8045, 8046, 8046, 8038, 8046, 8047, 8047, 8039,
8047, 8048, 8122, 8048, 8122, 8049, 8123, 8049, 8123, 8050, 8136,
8050, 8136, 8051, 8137, 8051, 8137, 8052, 8138, 8052, 8138, 8053,
8139, 8053, 8139, 8054, 8154, 8054, 8154, 8055, 8155, 8055, 8155,
8056, 8184, 8056, 8184, 8057, 8185, 8057, 8185, 8058, 8170, 8058,
8170, 8059, 8171, 8059, 8171, 8060, 8186, 8060, 8186, 8061, 8187,
8061, 8187, 8064, 8072, 8064, 8072, 8065, 8073, 8065, 8073, 8066,
8074, 8066, 8074, 8067, 8075, 8067, 8075, 8068, 8076, 8068, 8076,
8069, 8077, 8069, 8077, 8070, 8078, 8070, 8078, 8071, 8079, 8071,
8079, 8072, 8072, 8064, 8072, 8073, 8073, 8065, 8073, 8074, 8074,
8066, 8074, 8075, 8075, 8067, 8075, 8076, 8076, 8068, 8076, 8077,
8077, 8069, 8077, 8078, 8078, 8070, 8078, 8079, 8079, 8071, 8079,
8080, 8088, 8080, 8088, 8081, 8089, 8081, 8089, 8082, 8090, 8082,
8090, 8083, 8091, 8083, 8091, 8084, 8092, 8084, 8092, 8085, 8093,
8085, 8093, 8086, 8094, 8086, 8094, 8087, 8095, 8087, 8095, 8088,
8088, 8080, 8088, 8089, 8089, 8081, 8089, 8090, 8090, 8082, 8090,
8091, 8091, 8083, 8091, 8092, 8092, 8084, 8092, 8093, 8093, 8085,
8093, 8094, 8094, 8086, 8094, 8095, 8095, 8087, 8095, 8096, 8104,
8096, 8104, 8097, 8105, 8097, 8105, 8098, 8106, 8098, 8106, 8099,
8107, 8099, 8107, 8100, 8108, 8100, 8108, 8101, 8109, 8101, 8109,
8102, 8110, 8102, 8110, 8103, 8111, 8103, 8111, 8104, 8104, 8096,
8104, 8105, 8105, 8097, 8105, 8106, 8106, 8098, 8106, 8107, 8107,
8099, 8107, 8108, 8108, 8100, 8108, 8109, 8109, 8101, 8109, 8110,
8110, 8102, 8110, 8111, 8111, 8103, 8111, 8112, 8120, 8112, 8120,
8113, 8121, 8113, 8121, 8115, 8124, 8115, 8124, 8120, 8120, 8112,
8120, 8121, 8121, 8113, 8121, 8122, 8122, 8048, 8122, 8123, 8123,
8049, 8123, 8124, 8124, 8115, 8124, 8126, 921, 8126, 921, 8131,
8140, 8131, 8140, 8136, 8136, 8050, 8136, 8137, 8137, 8051, 8137,
8138, 8138, 8052, 8138, 8139, 8139, 8053, 8139, 8140, 8140, 8131,
8140, 8144, 8152, 8144, 8152, 8145, 8153, 8145, 8153, 8152, 8152,
8144, 8152, 8153, 8153, 8145, 8153, 8154, 8154, 8054, 8154, 8155,
8155, 8055, 8155, 8160, 8168, 8160, 8168, 8161, 8169, 8161, 8169,
8165, 8172, 8165, 8172, 8168, 8168, 8160, 8168, 8169, 8169, 8161,
8169, 8170, 8170, 8058, 8170, 8171, 8171, 8059, 8171, 8172, 8172,
8165, 8172, 8179, 8188, 8179, 8188, 8184, 8184, 8056, 8184, 8185,
8185, 8057, 8185, 8186, 8186, 8060, 8186, 8187, 8187, 8061, 8187,
8188, 8188, 8179, 8188, 8486, 8486, 969, 8486, 8490, 8490, 107,
8490, 8491, 8491, 229, 8491, 8544, 8544, 8560, 8544, 8545, 8545,
8561, 8545, 8546, 8546, 8562, 8546, 8547, 8547, 8563, 8547, 8548,
8548, 8564, 8548, 8549, 8549, 8565, 8549, 8550, 8550, 8566, 8550,
8551, 8551, 8567, 8551, 8552, 8552, 8568, 8552, 8553, 8553, 8569,
8553, 8554, 8554, 8570, 8554, 8555, 8555, 8571, 8555, 8556, 8556,
8572, 8556, 8557, 8557, 8573, 8557, 8558, 8558, 8574, 8558, 8559,
8559, 8575, 8559, 8560, 8544, 8560, 8544, 8561, 8545, 8561, 8545,
8562, 8546, 8562, 8546, 8563, 8547, 8563, 8547, 8564, 8548, 8564,
8548, 8565, 8549, 8565, 8549, 8566, 8550, 8566, 8550, 8567, 8551,
8567, 8551, 8568, 8552, 8568, 8552, 8569, 8553, 8569, 8553, 8570,
8554, 8570, 8554, 8571, 8555, 8571, 8555, 8572, 8556, 8572, 8556,
8573, 8557, 8573, 8557, 8574, 8558, 8574, 8558, 8575, 8559, 8575,
8559, 9398, 9398, 9424, 9398, 9399, 9399, 9425, 9399, 9400, 9400,
9426, 9400, 9401, 9401, 9427, 9401, 9402, 9402, 9428, 9402, 9403,
9403, 9429, 9403, 9404, 9404, 9430, 9404, 9405, 9405, 9431, 9405,
9406, 9406, 9432, 9406, 9407, 9407, 9433, 9407, 9408, 9408, 9434,
9408, 9409, 9409, 9435, 9409, 9410, 9410, 9436, 9410, 9411, 9411,
9437, 9411, 9412, 9412, 9438, 9412, 9413, 9413, 9439, 9413, 9414,
9414, 9440, 9414, 9415, 9415, 9441, 9415, 9416, 9416, 9442, 9416,
9417, 9417, 9443, 9417, 9418, 9418, 9444, 9418, 9419, 9419, 9445,
9419, 9420, 9420, 9446, 9420, 9421, 9421, 9447, 9421, 9422, 9422,
9448, 9422, 9423, 9423, 9449, 9423, 9424, 9398, 9424, 9398, 9425,
9399, 9425, 9399, 9426, 9400, 9426, 9400, 9427, 9401, 9427, 9401,
9428, 9402, 9428, 9402, 9429, 9403, 9429, 9403, 9430, 9404, 9430,
9404, 9431, 9405, 9431, 9405, 9432, 9406, 9432, 9406, 9433, 9407,
9433, 9407, 9434, 9408, 9434, 9408, 9435, 9409, 9435, 9409, 9436,
9410, 9436, 9410, 9437, 9411, 9437, 9411, 9438, 9412, 9438, 9412,
9439, 9413, 9439, 9413, 9440, 9414, 9440, 9414, 9441, 9415, 9441,
9415, 9442, 9416, 9442, 9416, 9443, 9417, 9443, 9417, 9444, 9418,
9444, 9418, 9445, 9419, 9445, 9419, 9446, 9420, 9446, 9420, 9447,
9421, 9447, 9421, 9448, 9422, 9448, 9422, 9449, 9423, 9449, 9423,
65313, 65313, 65345, 65313, 65314, 65314, 65346, 65314, 65315,
65315, 65347, 65315, 65316, 65316, 65348, 65316, 65317, 65317,
65349, 65317, 65318, 65318, 65350, 65318, 65319, 65319, 65351,
65319, 65320, 65320, 65352, 65320, 65321, 65321, 65353, 65321,
65322, 65322, 65354, 65322, 65323, 65323, 65355, 65323, 65324,
65324, 65356, 65324, 65325, 65325, 65357, 65325, 65326, 65326,
65358, 65326, 65327, 65327, 65359, 65327, 65328, 65328, 65360,
65328, 65329, 65329, 65361, 65329, 65330, 65330, 65362, 65330,
65331, 65331, 65363, 65331, 65332, 65332, 65364, 65332, 65333,
65333, 65365, 65333, 65334, 65334, 65366, 65334, 65335, 65335,
65367, 65335, 65336, 65336, 65368, 65336, 65337, 65337, 65369,
65337, 65338, 65338, 65370, 65338, 65345, 65313, 65345, 65313,
65346, 65314, 65346, 65314, 65347, 65315, 65347, 65315, 65348,
65316, 65348, 65316, 65349, 65317, 65349, 65317, 65350, 65318,
65350, 65318, 65351, 65319, 65351, 65319, 65352, 65320, 65352,
65320, 65353, 65321, 65353, 65321, 65354, 65322, 65354, 65322,
65355, 65323, 65355, 65323, 65356, 65324, 65356, 65324, 65357,
65325, 65357, 65325, 65358, 65326, 65358, 65326, 65359, 65327,
65359, 65327, 65360, 65328, 65360, 65328, 65361, 65329, 65361,
65329, 65362, 65330, 65362, 65330, 65363, 65331, 65363, 65331,
65364, 65332, 65364, 65332, 65365, 65333, 65365, 65333, 65366,
65334, 65366, 65334, 65367, 65335, 65367, 65335, 65368, 65336,
65368, 65336, 65369, 65337, 65369, 65337, 65370, 65338, 65370,
65338, 66560, 66560, 66600, 66560, 66561, 66561, 66601, 66561,
66562, 66562, 66602, 66562, 66563, 66563, 66603, 66563, 66564,
66564, 66604, 66564, 66565, 66565, 66605, 66565, 66566, 66566,
66606, 66566, 66567, 66567, 66607, 66567, 66568, 66568, 66608,
66568, 66569, 66569, 66609, 66569, 66570, 66570, 66610, 66570,
66571, 66571, 66611, 66571, 66572, 66572, 66612, 66572, 66573,
66573, 66613, 66573, 66574, 66574, 66614, 66574, 66575, 66575,
66615, 66575, 66576, 66576, 66616, 66576, 66577, 66577, 66617,
66577, 66578, 66578, 66618, 66578, 66579, 66579, 66619, 66579,
66580, 66580, 66620, 66580, 66581, 66581, 66621, 66581, 66582,
66582, 66622, 66582, 66583, 66583, 66623, 66583, 66584, 66584,
66624, 66584, 66585, 66585, 66625, 66585, 66586, 66586, 66626,
66586, 66587, 66587, 66627, 66587, 66588, 66588, 66628, 66588,
66589, 66589, 66629, 66589, 66590, 66590, 66630, 66590, 66591,
66591, 66631, 66591, 66592, 66592, 66632, 66592, 66593, 66593,
66633, 66593, 66594, 66594, 66634, 66594, 66595, 66595, 66635,
66595, 66596, 66596, 66636, 66596, 66597, 66597, 66637, 66597,
66598, 66598, 66638, 66598, 66599, 66599, 66639, 66599, 66600,
66560, 66600, 66560, 66601, 66561, 66601, 66561, 66602, 66562,
66602, 66562, 66603, 66563, 66603, 66563, 66604, 66564, 66604,
66564, 66605, 66565, 66605, 66565, 66606, 66566, 66606, 66566,
66607, 66567, 66607, 66567, 66608, 66568, 66608, 66568, 66609,
66569, 66609, 66569, 66610, 66570, 66610, 66570, 66611, 66571,
66611, 66571, 66612, 66572, 66612, 66572, 66613, 66573, 66613,
66573, 66614, 66574, 66614, 66574, 66615, 66575, 66615, 66575,
66616, 66576, 66616, 66576, 66617, 66577, 66617, 66577, 66618,
66578, 66618, 66578, 66619, 66579, 66619, 66579, 66620, 66580,
66620, 66580, 66621, 66581, 66621, 66581, 66622, 66582, 66622,
66582, 66623, 66583, 66623, 66583, 66624, 66584, 66624, 66584,
66625, 66585, 66625, 66585, 66626, 66586, 66626, 66586, 66627,
66587, 66627, 66587, 66628, 66588, 66628, 66588, 66629, 66589,
66629, 66589, 66630, 66590, 66630, 66590, 66631, 66591, 66631,
66591, 66632, 66592, 66632, 66592, 66633, 66593, 66633, 66593,
66634, 66594, 66634, 66594, 66635, 66595, 66635, 66595, 66636,
66596, 66636, 66596, 66637, 66597, 66637, 66597, 66638, 66598,
66638, 66598, 66639, 66599, 66639, 66599,
};

#define CASE_MAP2_LENGTH 103

static struct { int c; char *conv[3]; } case_map2[ CASE_MAP2_LENGTH ] = {
  { 223, { "\xc3\x9f", "\x53\x73", "\x53\x53", }},
  { 304, { "\x69\xcc\x87", "\xc4\xb0", "\xc4\xb0", }},
  { 329, { "\xc5\x89", "\xca\xbc\x4e", "\xca\xbc\x4e", }},
  { 496, { "\xc7\xb0", "\x4a\xcc\x8c", "\x4a\xcc\x8c", }},
  { 912, { "\xce\x90", "\xce\x99\xcc\x88\xcc\x81", "\xce\x99\xcc\x88\xcc\x81", }},
  { 944, { "\xce\xb0", "\xce\xa5\xcc\x88\xcc\x81", "\xce\xa5\xcc\x88\xcc\x81", }},
  { 1415, { "\xd6\x87", "\xd4\xb5\xd6\x82", "\xd4\xb5\xd5\x92", }},
  { 7830, { "\xe1\xba\x96", "\x48\xcc\xb1", "\x48\xcc\xb1", }},
  { 7831, { "\xe1\xba\x97", "\x54\xcc\x88", "\x54\xcc\x88", }},
  { 7832, { "\xe1\xba\x98", "\x57\xcc\x8a", "\x57\xcc\x8a", }},
  { 7833, { "\xe1\xba\x99", "\x59\xcc\x8a", "\x59\xcc\x8a", }},
  { 7834, { "\xe1\xba\x9a", "\x41\xca\xbe", "\x41\xca\xbe", }},
  { 8016, { "\xe1\xbd\x90", "\xce\xa5\xcc\x93", "\xce\xa5\xcc\x93", }},
  { 8018, { "\xe1\xbd\x92", "\xce\xa5\xcc\x93\xcc\x80", "\xce\xa5\xcc\x93\xcc\x80", }},
  { 8020, { "\xe1\xbd\x94", "\xce\xa5\xcc\x93\xcc\x81", "\xce\xa5\xcc\x93\xcc\x81", }},
  { 8022, { "\xe1\xbd\x96", "\xce\xa5\xcc\x93\xcd\x82", "\xce\xa5\xcc\x93\xcd\x82", }},
  { 8064, { "\xe1\xbe\x80", "\xe1\xbe\x88", "\xe1\xbc\x88\xce\x99", }},
  { 8065, { "\xe1\xbe\x81", "\xe1\xbe\x89", "\xe1\xbc\x89\xce\x99", }},
  { 8066, { "\xe1\xbe\x82", "\xe1\xbe\x8a", "\xe1\xbc\x8a\xce\x99", }},
  { 8067, { "\xe1\xbe\x83", "\xe1\xbe\x8b", "\xe1\xbc\x8b\xce\x99", }},
  { 8068, { "\xe1\xbe\x84", "\xe1\xbe\x8c", "\xe1\xbc\x8c\xce\x99", }},
  { 8069, { "\xe1\xbe\x85", "\xe1\xbe\x8d", "\xe1\xbc\x8d\xce\x99", }},
  { 8070, { "\xe1\xbe\x86", "\xe1\xbe\x8e", "\xe1\xbc\x8e\xce\x99", }},
  { 8071, { "\xe1\xbe\x87", "\xe1\xbe\x8f", "\xe1\xbc\x8f\xce\x99", }},
  { 8072, { "\xe1\xbe\x80", "\xe1\xbe\x88", "\xe1\xbc\x88\xce\x99", }},
  { 8073, { "\xe1\xbe\x81", "\xe1\xbe\x89", "\xe1\xbc\x89\xce\x99", }},
  { 8074, { "\xe1\xbe\x82", "\xe1\xbe\x8a", "\xe1\xbc\x8a\xce\x99", }},
  { 8075, { "\xe1\xbe\x83", "\xe1\xbe\x8b", "\xe1\xbc\x8b\xce\x99", }},
  { 8076, { "\xe1\xbe\x84", "\xe1\xbe\x8c", "\xe1\xbc\x8c\xce\x99", }},
  { 8077, { "\xe1\xbe\x85", "\xe1\xbe\x8d", "\xe1\xbc\x8d\xce\x99", }},
  { 8078, { "\xe1\xbe\x86", "\xe1\xbe\x8e", "\xe1\xbc\x8e\xce\x99", }},
  { 8079, { "\xe1\xbe\x87", "\xe1\xbe\x8f", "\xe1\xbc\x8f\xce\x99", }},
  { 8080, { "\xe1\xbe\x90", "\xe1\xbe\x98", "\xe1\xbc\xa8\xce\x99", }},
  { 8081, { "\xe1\xbe\x91", "\xe1\xbe\x99", "\xe1\xbc\xa9\xce\x99", }},
  { 8082, { "\xe1\xbe\x92", "\xe1\xbe\x9a", "\xe1\xbc\xaa\xce\x99", }},
  { 8083, { "\xe1\xbe\x93", "\xe1\xbe\x9b", "\xe1\xbc\xab\xce\x99", }},
  { 8084, { "\xe1\xbe\x94", "\xe1\xbe\x9c", "\xe1\xbc\xac\xce\x99", }},
  { 8085, { "\xe1\xbe\x95", "\xe1\xbe\x9d", "\xe1\xbc\xad\xce\x99", }},
  { 8086, { "\xe1\xbe\x96", "\xe1\xbe\x9e", "\xe1\xbc\xae\xce\x99", }},
  { 8087, { "\xe1\xbe\x97", "\xe1\xbe\x9f", "\xe1\xbc\xaf\xce\x99", }},
  { 8088, { "\xe1\xbe\x90", "\xe1\xbe\x98", "\xe1\xbc\xa8\xce\x99", }},
  { 8089, { "\xe1\xbe\x91", "\xe1\xbe\x99", "\xe1\xbc\xa9\xce\x99", }},
  { 8090, { "\xe1\xbe\x92", "\xe1\xbe\x9a", "\xe1\xbc\xaa\xce\x99", }},
  { 8091, { "\xe1\xbe\x93", "\xe1\xbe\x9b", "\xe1\xbc\xab\xce\x99", }},
  { 8092, { "\xe1\xbe\x94", "\xe1\xbe\x9c", "\xe1\xbc\xac\xce\x99", }},
  { 8093, { "\xe1\xbe\x95", "\xe1\xbe\x9d", "\xe1\xbc\xad\xce\x99", }},
  { 8094, { "\xe1\xbe\x96", "\xe1\xbe\x9e", "\xe1\xbc\xae\xce\x99", }},
  { 8095, { "\xe1\xbe\x97", "\xe1\xbe\x9f", "\xe1\xbc\xaf\xce\x99", }},
  { 8096, { "\xe1\xbe\xa0", "\xe1\xbe\xa8", "\xe1\xbd\xa8\xce\x99", }},
  { 8097, { "\xe1\xbe\xa1", "\xe1\xbe\xa9", "\xe1\xbd\xa9\xce\x99", }},
  { 8098, { "\xe1\xbe\xa2", "\xe1\xbe\xaa", "\xe1\xbd\xaa\xce\x99", }},
  { 8099, { "\xe1\xbe\xa3", "\xe1\xbe\xab", "\xe1\xbd\xab\xce\x99", }},
  { 8100, { "\xe1\xbe\xa4", "\xe1\xbe\xac", "\xe1\xbd\xac\xce\x99", }},
  { 8101, { "\xe1\xbe\xa5", "\xe1\xbe\xad", "\xe1\xbd\xad\xce\x99", }},
  { 8102, { "\xe1\xbe\xa6", "\xe1\xbe\xae", "\xe1\xbd\xae\xce\x99", }},
  { 8103, { "\xe1\xbe\xa7", "\xe1\xbe\xaf", "\xe1\xbd\xaf\xce\x99", }},
  { 8104, { "\xe1\xbe\xa0", "\xe1\xbe\xa8", "\xe1\xbd\xa8\xce\x99", }},
  { 8105, { "\xe1\xbe\xa1", "\xe1\xbe\xa9", "\xe1\xbd\xa9\xce\x99", }},
  { 8106, { "\xe1\xbe\xa2", "\xe1\xbe\xaa", "\xe1\xbd\xaa\xce\x99", }},
  { 8107, { "\xe1\xbe\xa3", "\xe1\xbe\xab", "\xe1\xbd\xab\xce\x99", }},
  { 8108, { "\xe1\xbe\xa4", "\xe1\xbe\xac", "\xe1\xbd\xac\xce\x99", }},
  { 8109, { "\xe1\xbe\xa5", "\xe1\xbe\xad", "\xe1\xbd\xad\xce\x99", }},
  { 8110, { "\xe1\xbe\xa6", "\xe1\xbe\xae", "\xe1\xbd\xae\xce\x99", }},
  { 8111, { "\xe1\xbe\xa7", "\xe1\xbe\xaf", "\xe1\xbd\xaf\xce\x99", }},
  { 8114, { "\xe1\xbe\xb2", "\xe1\xbe\xba\xcd\x85", "\xe1\xbe\xba\xce\x99", }},
  { 8115, { "\xe1\xbe\xb3", "\xe1\xbe\xbc", "\xce\x91\xce\x99", }},
  { 8116, { "\xe1\xbe\xb4", "\xce\x86\xcd\x85", "\xce\x86\xce\x99", }},
  { 8118, { "\xe1\xbe\xb6", "\xce\x91\xcd\x82", "\xce\x91\xcd\x82", }},
  { 8119, { "\xe1\xbe\xb7", "\xce\x91\xcd\x82\xcd\x85", "\xce\x91\xcd\x82\xce\x99", }},
  { 8124, { "\xe1\xbe\xb3", "\xe1\xbe\xbc", "\xce\x91\xce\x99", }},
  { 8130, { "\xe1\xbf\x82", "\xe1\xbf\x8a\xcd\x85", "\xe1\xbf\x8a\xce\x99", }},
  { 8131, { "\xe1\xbf\x83", "\xe1\xbf\x8c", "\xce\x97\xce\x99", }},
  { 8132, { "\xe1\xbf\x84", "\xce\x89\xcd\x85", "\xce\x89\xce\x99", }},
  { 8134, { "\xe1\xbf\x86", "\xce\x97\xcd\x82", "\xce\x97\xcd\x82", }},
  { 8135, { "\xe1\xbf\x87", "\xce\x97\xcd\x82\xcd\x85", "\xce\x97\xcd\x82\xce\x99", }},
  { 8140, { "\xe1\xbf\x83", "\xe1\xbf\x8c", "\xce\x97\xce\x99", }},
  { 8146, { "\xe1\xbf\x92", "\xce\x99\xcc\x88\xcc\x80", "\xce\x99\xcc\x88\xcc\x80", }},
  { 8147, { "\xe1\xbf\x93", "\xce\x99\xcc\x88\xcc\x81", "\xce\x99\xcc\x88\xcc\x81", }},
  { 8150, { "\xe1\xbf\x96", "\xce\x99\xcd\x82", "\xce\x99\xcd\x82", }},
  { 8151, { "\xe1\xbf\x97", "\xce\x99\xcc\x88\xcd\x82", "\xce\x99\xcc\x88\xcd\x82", }},
  { 8162, { "\xe1\xbf\xa2", "\xce\xa5\xcc\x88\xcc\x80", "\xce\xa5\xcc\x88\xcc\x80", }},
  { 8163, { "\xe1\xbf\xa3", "\xce\xa5\xcc\x88\xcc\x81", "\xce\xa5\xcc\x88\xcc\x81", }},
  { 8164, { "\xe1\xbf\xa4", "\xce\xa1\xcc\x93", "\xce\xa1\xcc\x93", }},
  { 8166, { "\xe1\xbf\xa6", "\xce\xa5\xcd\x82", "\xce\xa5\xcd\x82", }},
  { 8167, { "\xe1\xbf\xa7", "\xce\xa5\xcc\x88\xcd\x82", "\xce\xa5\xcc\x88\xcd\x82", }},
  { 8178, { "\xe1\xbf\xb2", "\xe1\xbf\xba\xcd\x85", "\xe1\xbf\xba\xce\x99", }},
  { 8179, { "\xe1\xbf\xb3", "\xe1\xbf\xbc", "\xce\xa9\xce\x99", }},
  { 8180, { "\xe1\xbf\xb4", "\xce\x8f\xcd\x85", "\xce\x8f\xce\x99", }},
  { 8182, { "\xe1\xbf\xb6", "\xce\xa9\xcd\x82", "\xce\xa9\xcd\x82", }},
  { 8183, { "\xe1\xbf\xb7", "\xce\xa9\xcd\x82\xcd\x85", "\xce\xa9\xcd\x82\xce\x99", }},
  { 8188, { "\xe1\xbf\xb3", "\xe1\xbf\xbc", "\xce\xa9\xce\x99", }},
  { 64256, { "\xef\xac\x80", "\x46\x66", "\x46\x46", }},
  { 64257, { "\xef\xac\x81", "\x46\x69", "\x46\x49", }},
  { 64258, { "\xef\xac\x82", "\x46\x6c", "\x46\x4c", }},
  { 64259, { "\xef\xac\x83", "\x46\x66\x69", "\x46\x46\x49", }},
  { 64260, { "\xef\xac\x84", "\x46\x66\x6c", "\x46\x46\x4c", }},
  { 64261, { "\xef\xac\x85", "\x53\x74", "\x53\x54", }},
  { 64262, { "\xef\xac\x86", "\x53\x74", "\x53\x54", }},
  { 64275, { "\xef\xac\x93", "\xd5\x84\xd5\xb6", "\xd5\x84\xd5\x86", }},
  { 64276, { "\xef\xac\x94", "\xd5\x84\xd5\xa5", "\xd5\x84\xd4\xb5", }},
  { 64277, { "\xef\xac\x95", "\xd5\x84\xd5\xab", "\xd5\x84\xd4\xbb", }},
  { 64278, { "\xef\xac\x96", "\xd5\x8e\xd5\xb6", "\xd5\x8e\xd5\x86", }},
  { 64279, { "\xef\xac\x97", "\xd5\x84\xd5\xad", "\xd5\x84\xd4\xbd", }},
}; 

/* Branchless UTF-8 decoder
 * https://raw.githubusercontent.com/skeeto/branchless-utf8/
 * This is free and unencumbered software released into the public domain.
 */

/* Decode the next character, C, from BUF, reporting errors in E.
 *
 * Since this is a branchless decoder, four bytes will be read from the
 * buffer regardless of the actual length of the next character. This
 * means the buffer _must_ have at least three bytes of zero padding
 * following the end of the data stream.
 *
 * Errors are reported in E, which will be non-zero if the parsed
 * character was somehow invalid: invalid byte sequence, non-canonical
 * encoding, or a surrogate half.
 *
 * The function returns a pointer to the next character. When an error
 * occurs, this pointer will be a guess that depends on the particular
 * error, but it will always advance at least one byte.
 */
static const char lengths[] = {
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
    0, 0, 0, 0, 0, 0, 0, 0, 2, 2, 2, 2, 3, 3, 4, 0
};

static C_char *utf8_decode(C_char *buf, C_u32 *c, int *e)
{
    static const int masks[]  = {0x00, 0x7f, 0x1f, 0x0f, 0x07};
    static const uint32_t mins[] = {4194304, 0, 128, 2048, 65536};
    static const int shiftc[] = {0, 18, 12, 6, 0};
    static const int shifte[] = {0, 6, 4, 2, 0};

#ifdef DEBUGBUILD
    if(buf == NULL) 
        C_panic_hook(C_text("possibly invalid string index"));
#endif

    unsigned char *s = (unsigned char *)buf;
    int len = lengths[s[0] >> 3];

    /* Compute the pointer to the next character early so that the next
     * iteration can start working on the next character. Neither Clang
     * nor GCC figure out this reordering on their own.
     */
    unsigned char *next = s + len + !len;

    /* Assume a four-byte character and load four bytes. Unused bits are
     * shifted out.
     */
    *c  = (C_u32)(s[0] & masks[len]) << 18;
    *c |= (C_u32)(s[1] & 0x3f) << 12;
    *c |= (C_u32)(s[2] & 0x3f) <<  6;
    *c |= (C_u32)(s[3] & 0x3f) <<  0;
    *c >>= shiftc[len];

    /* Accumulate the various error conditions. */
    *e  = (*c < mins[len]) << 6; // non-canonical encoding
    *e |= ((*c >> 11) == 0x1b) << 7;  // surrogate half?
    *e |= (*c > 0x10FFFF) << 8;  // out of range?
    *e |= (s[1] & 0xc0) >> 2;
    *e |= (s[2] & 0xc0) >> 4;
    *e |= (s[3]       ) >> 6;
    *e ^= 0x2a; // top two bits of each tail byte correct?
    *e >>= shifte[len];

    return (C_char *)next;
}
/* */

static C_char *utf8_encode(C_u32 u, C_char *p1)
{
    unsigned char *p = (unsigned char *)p1;
    if(u < 0x80) *(p++) = u;
    else if(u < 0x800) {
        *(p++) = (u >> 6) | 0xC0;
        *(p++) = (u & 0x3F) | 0x80;
    } else if(u < 0x10000) {
        *(p++) = (u >> 12) | 0xE0;
        *(p++) = ((u >> 6) & 0x3F) | 0x80;
        *(p++) = (u & 0x3F) | 0x80;
    } else if(u < 0x110000) {
        *(p++) = (u >> 18) | 0xF0;
        *(p++) = ((u >> 12) & 0x3F) | 0x80;
        *(p++) = ((u >> 6) & 0x3F) | 0x80;
        *(p++) = (u & 0x3F) | 0x80;
    }
    return (C_char *)p;
}

/* XXX not used yet */
static C_char *utf_map_multi(int c, int mode)
{
    int i;
    for(i = 0; i < CASE_MAP2_LENGTH; ++i) {
        if(case_map2[ i ].c == c) return case_map2[ i ].conv[ mode ];
    }
    return NULL;
}

static int *utf_map_single(int c)
{
    int lo = 0, hi = CASE_MAP1_LENGTH - 1;
    while(hi != lo) {
        int mid = lo + (hi - lo) / 2;
        int val = case_map1[ mid * 4 ];
        if(c < val) {
            if(mid == hi) return NULL;
            hi = mid;
        } else if(c > val) {
            if(mid == lo) return NULL;
            lo = mid;
        } else return case_map1 + mid * 4;
    }
    return NULL;
}

/* only handles single char case */
static int utf_downcase(int c) 
{
    int *p;
    if(c < 128) return C_tolower(c);
    p = utf_map_single(c);
    if(p != NULL) return p[ 2 ];
    return c;
}

static int utf_upcase(int c) 
{
    int *p;
    if(c < 128) return C_toupper(c);
    p = utf_map_single(c);
    if(p != NULL) return p[ 1 ];
    return c;
}

static C_char *utf_index(C_word s, C_word i) 
{
    C_word i0 = C_unfix(C_block_item(s, 2));
    C_word count = C_unfix(C_block_item(s, 1));
    C_word off = 0, index = 0;
    C_char *p1, *p = C_data_pointer(C_block_item(s, 0));
    int e;
    C_u32 c;
    if(i >= i0) {
        p += off = C_unfix(C_block_item(s, 3));
        index = i0;
    }
    /* this can surely be done more efficiently... */
    while(index <= count) {
        if(index == i) {
            C_set_block_item(s, 2, C_fix(index));
            C_set_block_item(s, 3, C_fix(off));
            return p;
        }
        p1 = p;
        p = utf8_decode(p, &c, &e);
        if(e != 0) return NULL;
        ++index;
        off += p - p1;
    }
    return NULL;
}

C_regparm C_word C_fcall C_utf_subchar(C_word s, C_word i) 
{
    C_char *p = utf_index(s, C_unfix(i));
    int e;
    C_u32 c;
    utf8_decode(p, &c, &e);
    if(e != 0) C_decoding_error(s, i);
    return C_make_character(c);
}

C_regparm C_word C_fcall C_utf_setsubchar(C_word s, C_word i, C_word c) 
{
    C_char buf[ 4 ];
    C_char *p = utf8_encode(C_character_code(c), buf);
    int e;
    C_u32 old;
    C_char *p1 = utf_index(s, C_unfix(i));
    C_char *p2 = utf8_decode(p1, &old, &e);
    int nl = p - buf, ol = p2 - p1;
    C_word bv = C_block_item(s, 0);
    C_word bvlen = C_header_size(bv) - 1;
    int prefix = C_unfix(C_block_item(s, 3));    /* offset */
    int suffix = bvlen - prefix - ol;

    if(nl > ol) {
        int tl = bvlen + nl - ol;
        if(C_in_scratchspacep(bv))
            C_mutate_scratch_slot(NULL, bv);
        C_word bvn = C_scratch_alloc(C_bytestowords(tl) + 1);
        C_block_header_init(bvn, C_make_header(C_BYTEVECTOR_TYPE, tl + 1));
        if(prefix) C_memcpy(C_c_string(bvn), C_c_string(bv), prefix);
        C_memcpy((C_char *)C_data_pointer(bvn) + prefix, buf, nl);
        C_memcpy((C_char *)C_data_pointer(bvn) + prefix + nl, 
            (C_char *)C_data_pointer(bv) + prefix + ol, suffix + 1); /* include 0 byte */
        C_mutate_scratch_slot(&C_block_item(s, 0), bvn);
    } else if(nl < ol) {
        C_memcpy(p1, buf, nl);
        C_memmove(p1 + nl, p1 + ol, suffix + 1); /* include 0 byte */
        C_block_header_init(bv, C_make_header(C_BYTEVECTOR_TYPE, bvlen - (ol - nl) + 1));
    } else C_memcpy(p1, buf, nl);

    return C_SCHEME_UNDEFINED;
}

/* copy c bytes of bv into s at position i, occupying len characters */
C_regparm C_word C_fcall C_utf_overwrite(C_word s, C_word i, C_word len, C_word bv, 
    C_word c) 
{
    C_word bvs = C_block_item(s, 0);
    C_word bvlen = C_header_size(bvs) - 1;
    C_char *p1 = utf_index(s, C_unfix(i));
    C_char *p2 = utf_index(s, C_unfix(i) + C_unfix(len));
    int count = C_unfix(c);
    int d = p2 - p1;
    int prefix = p1 - (C_char *)C_data_pointer(bvs);
    int suffix = bvlen - prefix - d;

    if(count > d) {
        int tl = bvlen + count - d;
        if(C_in_scratchspacep(bvs))
            C_mutate_scratch_slot(NULL, bvs);
        C_word bvn = C_scratch_alloc(C_bytestowords(tl) + 1);
        C_block_header_init(bvn, C_make_header(C_BYTEVECTOR_TYPE, tl + 1));
        if(prefix) C_memcpy(C_c_string(bvn), C_data_pointer(bvs), prefix);
        C_memcpy((C_char *)C_data_pointer(bvn) + prefix, (C_char *)C_data_pointer(bv), 
            count);
        C_memcpy((C_char *)C_data_pointer(bvn) + prefix + count, 
            p2, suffix + 1); /* include 0 byte */
        C_mutate_scratch_slot(&C_block_item(s, 0), bvn);
    } else if(count < d) {
        C_memcpy(p1, C_data_pointer(bv), count);
        C_memmove(p1 + count, p2, suffix + 1); /* include 0 byte */
        C_block_header_init(bvs, C_make_header(C_BYTEVECTOR_TYPE, 
            bvlen - (d - count) + 1));
    } else if(count) C_memcpy(p1, C_data_pointer(bvs), count);

    return C_SCHEME_UNDEFINED;
}

/* XXX inline this? */
C_regparm C_word C_fcall C_utf_compare(C_word s1, C_word s2, C_word start1, C_word start2,
    C_word len)
{
    C_char *p1 = utf_index(s1, C_unfix(start1));
    C_char *p2 = utf_index(s2, C_unfix(start2));
    return C_fix(C_memcmp(p1, p2, C_unfix(len)));
}

C_regparm C_word C_fcall C_utf_compare_ci(C_word s1, C_word s2, C_word start1, C_word start2, C_word len)
{
    C_char *p1 = utf_index(s1, C_unfix(start1));
    C_char *p2 = utf_index(s2, C_unfix(start2));
    int e, n = C_unfix(len);
    while(n--) {
        C_u32 c1, c2;
        p1 = utf8_decode(p1, &c1, &e);
        p2 = utf8_decode(p2, &c2, &e);
        c1 = utf_downcase(c1);
        c2 = utf_downcase(c2);
        if(c1 != c2) return C_fix((C_word)c1 - (C_word)c2);
    }
    return C_fix(0);
}

/* XXX inline this? */
C_regparm C_word C_fcall C_utf_equal(C_word s1, C_word s2)
{
    C_word b1 = C_block_item(s1, 0);
    C_word b2 = C_block_item(s2, 0);
    int n1 = C_header_size(b1);
    int n2 = C_header_size(b2); 
    if(n1 != n2) return C_SCHEME_FALSE;
    return C_mk_bool(C_memcmp(C_c_string(b1), C_c_string(b2), n1) == 0);
}

/* XXX inline this? */
C_regparm C_word C_fcall C_utf_equal_ci(C_word s1, C_word s2)
{
    C_word n1 = C_block_item(s1, 1);
    if(n1 != C_block_item(s2, 1)) return C_SCHEME_FALSE;
    return C_mk_bool(C_utf_compare_ci(s1, s2, C_fix(0), C_fix(0), n1) == C_fix(0));
}

C_regparm C_word C_fcall C_utf_copy(C_word from, C_word to, C_word start1, C_word end1, C_word start2)
{
    C_char *p1 = utf_index(from, C_unfix(start1));
    C_char *p2 = utf_index(to, C_unfix(start2));
    C_char *p3 = utf_index(from, C_unfix(end1));
    C_memcpy(p2, p1, p3 - p1);
    return C_SCHEME_UNDEFINED;
}

/* compute byte-index from char-index */
C_regparm C_word C_fcall C_utf_position(C_word str, C_word start)
{
    C_char *p1 = utf_index(str, C_unfix(start));
    return C_fix(p1 - (C_char *)C_data_pointer(C_block_item(str, 0)));
}

/* compute byte-offset between two char-indices */
C_regparm C_word C_fcall C_utf_range(C_word str, C_word start, C_word end)
{
    C_char *p1 = utf_index(str, C_unfix(start));
    C_char *p2 = utf_index(str, C_unfix(end));
    return C_fix(p2 - p1);
}

/* count characters
   http://canonical.org/~kragen/strlen-utf8.html */
C_regparm int C_fcall C_utf_count(C_char *s, int len) 
{
    int i = 0, j = 0;   
    while (len--) {
        if ((s[i] & 0xc0) != 0x80) j++;
        i++;
    }
    return j; 
} 

C_regparm C_word C_fcall C_utf_bytes(C_word chr)
{
    int e;
    char buf[ 5 ];
    C_char *p1 = utf8_encode(C_character_code(chr), buf);
    return C_fix(p1 - buf);
}

C_regparm C_char * C_fcall C_utf_encode(C_char *str, int chr)
{
    return utf8_encode(chr, str);
}

C_regparm C_word C_fcall C_utf_decode(C_word bv, C_word pos)
{
    C_u32 c;
    int e;
    utf8_decode((C_char *)C_data_pointer(bv) + C_unfix(pos), &c, &e);
    return C_make_character(c);
}

C_regparm C_word C_fcall C_utf_decode_ptr(C_char *bv)
{
    C_u32 c;
    int e;
    utf8_decode(bv, &c, &e);
    return C_make_character(c);
}

C_regparm C_word C_fcall C_utf_char_downcase(C_word c)
{
    return C_make_character(utf_downcase(C_character_code(c)));
}

C_regparm C_word C_fcall C_utf_char_upcase(C_word c)
{
    return C_make_character(utf_upcase(C_character_code(c)));
}

C_regparm C_word C_fcall C_utf_advance(C_word bv, C_word pos)
{
    C_char *p1 = (C_char *)C_data_pointer(bv) + C_unfix(pos);
    C_u32 c;
    int e;
    C_char *p2 = utf8_decode(p1, &c, &e);
    return C_fix(C_unfix(pos) + p2 - p1);
}

C_regparm C_word C_fcall C_utf_insert(C_word bv, C_word pos, C_word c)
{
    C_char *p1 = (C_char *)C_data_pointer(bv) + C_unfix(pos);
    C_char *p2 = utf8_encode(C_character_code(c), p1);
    return C_fix(C_unfix(pos) + p2 - p1);
}

C_regparm C_word C_fcall C_utf_fill(C_word bv, C_word chr)
{
    char buf[ 5 ];
    int size = C_header_size(bv) - 1;
    int len = C_utf_encode(buf, C_character_code(chr)) - buf;
    C_char *p;
    int n;

    if(len == 1) {
        C_memset(C_data_pointer(bv), *buf, size);
        return bv;
    }

    p = C_data_pointer(bv);
    n = size / len;

    while(n--) {
        C_memcpy(p, buf, len);
        p += len;
    }
    ((C_char *)C_data_pointer(bv))[ size ] = 0; /* terminating zero */
    return bv;
}

C_regparm int C_fcall C_utf_expect(int byte)
{
    int len = lengths[ byte >> 3 ];
    return len + !len;
}

C_regparm C_word C_fcall C_utf_fragment_counts(C_word bv, C_word pos, C_word len)
{
    int full = 0;
    C_uchar *ptr = C_data_pointer(bv) + C_unfix(pos);
    int count = C_unfix(len);

    while(count) {
        unsigned int byte = *(ptr++);
        int n = lengths[ byte >> 3 ];
        int bn = n + !n;
        if(count >= bn) ++full;
        else return C_fix((full << 4) | (bn - count));
        count -= bn;
    }
    
    return C_fix(full << 4);
}

C_regparm void C_fcall C_utf_putc(int chr, C_FILEPTR fp) 
{
    C_char buf[ 5 ];
    C_char *p = utf8_encode(chr, buf);
    *p = '\0';
    C_fputs(buf, fp);
}
